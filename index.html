<!doctype html>

<html>
<head>
	<meta charset="utf-8"> 
	<title> CF API </title>
	<script src="https://www.gstatic.com/charts/loader.js"></script>
	<script src="https://code.getmdl.io/1.3.0/material.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
</head>
<body>
	<input type = "text" id = "handle">
	<button type = "button" onclick = "getData()"> Touch me </button> <br />
	<table  >
	<tr>
		<td>
		<img src="" id = "dp"> <br \>
		</td>
		<td>
		Given Handle: <span id = "ghandle"></span> <br />
		Name: <span id="name"></span> <br />
		Rating: <span id = "rating" ></span> <br />
		Image link: <span id = "image" ></span> 
		</td>
		
	
	</tr>
	</table>
	<canvas id="myChart" width="4" height="1"></canvas>
	<script>
		//getData();
		async function getData(){
			const api_url = 'https://codeforces.com/api/user.info?handles='+document.getElementById("handle").value;
			const contest_url = "https://codeforces.com/api/user.rating?handle="+document.getElementById("handle").value;
			const response = await fetch(api_url);
			const data = await response.json();
			
			document.getElementById('ghandle').textContent = document.getElementById("handle").value;
			if( data.status == "OK" ){
				console.log(data.result.length);
				document.getElementById('name').textContent = data.result[0].handle;
				document.getElementById('rating').textContent = data.result[0].rating;
				document.getElementById("image").textContent = data.result[0].titlePhoto;
				document.getElementById("dp").src = "https:"+data.result[0].titlePhoto;
				
			} else{
				document.getElementById('name').textContent = "Error";
				document.getElementById('rating').textContent = "Error";
			}
			const cresponse = await fetch(contest_url);
			const cdata = await cresponse.json();
			if(cdata.status == "OK"){
				const datalabels = [];
				const datax = [];
				for(i=0;i<cdata.result.length;i++){
					datalabels.push(i+1);
					datax.push(cdata.result[i].newRating);
				}
				createchart(datalabels,datax);
			}
			
			
		}
		
		function createchart(datalabels,datax){
			var ctx = document.getElementById('myChart').getContext('2d');
			var myChart = new Chart(ctx, {
				type: 'line',
				
				data: {
					labels: datalabels,
					datasets: [{
						label: 'Contest Rating Changes',
						data: datax,
						fill: false,
						backgroundColor: 'rgba(0, 0, 0, 1)',
						borderColor: 'rgba(255, 99, 132, 1)',
						borderWidth: 1
					}]
				},
				options: {
					
					scales: {
						yAxes: [{
							ticks: {
								beginAtZero: false
							}
						}]
					}
				}
			});
		}
		
	</script>

</body>
</html>
